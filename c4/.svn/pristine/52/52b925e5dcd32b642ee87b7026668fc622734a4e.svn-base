new gnMenu(document.getElementById('gn-menu'));
var l=window.location.hash.substr(1),
	map,
	dis_o_col,
	marcadores=[],
	ubicalosFirst=1,
	intervaloMarcadores,
	todosdiv="",
	viendo='',
	infoWindow,
	nvoDivi=0,
	nvoArea=0,
	ForDistritos,
	ForColonias,
	RegionesUser=[],
	RegionesCR=[],
	dG=$('.principal .ui-autocomplete-input'),
	aG=$('.principal .busca'),
	tablaFielders=$('#tablaFielders').DataTable({language:{url:"../js/esp.json"}});
$('#wraper').height(h);window.addEventListener("resize",altura);
function altura(){h=window.innerHeight-70;$('#wraper').height(h);}
if(l=="34fTRc"){window.location.hash='';sessionStorage.setItem('u','ñ{ṕdfT');
window.location.replace(window.location.href.slice(0,-1));}
if(sessionStorage.getItem('u')!='ñ{ṕdfT')salir();
Highcharts.createElement('link',{href: '//fonts.googleapis.com/css?family=Lato:400,300',rel:'stylesheet',type:'text/css'},null,document.getElementsByTagName('head')[0]);
Highcharts.theme={
	colors:["#282D3D","#7A0002","#6E7999","#203368","#8F909D"],
	chart:{backgroundColor:'rgba(0,0,0,0)',style:{fontFamily:"'Lato', sans-serif"}},
	title:{style:{color:'#E0E0E3',fontSize:'20px'}},
	tooltip:{backgroundColor:'#ffffff',style:{color:'#000000'}},
	plotOptions:{series:{dataLabels:{color:'#ffffff',style:{fontSize:'15px',fontWeight:'300'}}}}
};Highcharts.setOptions(Highcharts.theme);
$('#grafico').highcharts({
	credits:{enabled:false},
	colorAxis:{minColor:Highcharts.getOptions().colors[2],maxColor:Highcharts.getOptions().colors[4]},
	series:[{type:'treemap',
		data:[{name:'Fielders',value:200,colorValue:1
			},{name:'Distritos',value:850,colorValue:2
			},{name:'Campañas',value:32,colorValue:3}],
		borderWidth:0
	}],
	legend:{enabled:false},title:{text:'',align:'left',x:0,margin:0}
});

var llave="",
	dataCartografica={},
	dataCartograficaDistritos={},
	capas={},
	infowindows={},
	contentInfoPoly="",
	poligonosCords={},
	poligonos={},
	testing={};
function creaMapa(s){
	function estilos(){
		var estilo=[{"featureType":"landscape.man_made","elementType":"geometry","stylers":[{"color":"#f7f1df"}]},{"featureType":"landscape.natural","elementType":"geometry","stylers":[{"color":"#d0e3b4"}]},{"featureType":"landscape.natural.terrain","elementType":"geometry","stylers":[{"visibility":"off"}]},{"featureType":"poi","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"poi.business","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi.medical","elementType":"geometry","stylers":[{"color":"#fbd3da"}]},{"featureType":"poi.park","elementType":"geometry","stylers":[{"color":"#bde6ab"}]},{"featureType":"road","elementType":"geometry.stroke","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#ffe15f"}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#efd151"}]},{"featureType":"road.arterial","elementType":"geometry.fill","stylers":[{"color":"#ffffff"}]},{"featureType":"road.local","elementType":"geometry.fill","stylers":[{"color":"black"}]},{"featureType":"transit.station.airport","elementType":"geometry.fill","stylers":[{"color":"#cfb2db"}]},{"featureType":"water","elementType":"geometry","stylers":[{"color":"#a2daf2"}]}];
		if(s=="Green")
			estilo=[{"elementType":"geometry","stylers":[{"hue":"#ff4400"},{"saturation":-68},{"lightness":-4},{"gamma":0.72}]},{"featureType":"road","elementType":"labels.icon"},{"featureType":"landscape.man_made","elementType":"geometry","stylers":[{"hue":"#0077ff"},{"gamma":3.1}]},{"featureType":"water","stylers":[{"hue":"#00ccff"},{"gamma":0.44},{"saturation":-33}]},{"featureType":"poi.park","stylers":[{"hue":"#44ff00"},{"saturation":-23}]},{"featureType":"water","elementType":"labels.text.fill","stylers":[{"hue":"#007fff"},{"gamma":0.77},{"saturation":65},{"lightness":99}]},{"featureType":"water","elementType":"labels.text.stroke","stylers":[{"gamma":0.11},{"weight":5.6},{"saturation":99},{"hue":"#0091ff"},{"lightness":-86}]},{"featureType":"transit.line","elementType":"geometry","stylers":[{"lightness":-48},{"hue":"#ff5e00"},{"gamma":1.2},{"saturation":-23}]},{"featureType":"transit","elementType":"labels.text.stroke","stylers":[{"saturation":-64},{"hue":"#ff9100"},{"lightness":16},{"gamma":0.47},{"weight":2.7}]}];
		else if(s=="Blanco")
			estilo=[{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f1eede"},{"saturation":"-42"},{"lightness":"40"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#88cddf"},{"visibility":"on"}]}];
		else if(s=="Aquamarina")
			estilo=[{"featureType":"landscape.natural","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"color":"#e0efef"}]},{"featureType":"poi","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"hue":"#1900ff"},{"color":"#c0e8e8"}]},{"featureType":"road","elementType":"geometry","stylers":[{"lightness":100},{"visibility":"simplified"}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"transit.line","elementType":"geometry","stylers":[{"visibility":"on"},{"lightness":700}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#7dcdcd"}]}];
		else if(s=="Night Cop")
			estilo=[{"featureType":"all","elementType":"labels.text.fill","stylers":[{"color":"#ffffff"}]},{"featureType":"all","elementType":"labels.text.stroke","stylers":[{"color":"#000000"},{"lightness":13}]},{"featureType":"administrative","elementType":"geometry.fill","stylers":[{"color":"#000000"}]},{"featureType":"administrative","elementType":"geometry.stroke","stylers":[{"color":"#144b53"},{"lightness":14},{"weight":1.4}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#08304b"}]},{"featureType":"poi","elementType":"geometry","stylers":[{"color":"#0c4152"},{"lightness":5}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#000000"}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#0b434f"},{"lightness":25}]},{"featureType":"road.arterial","elementType":"geometry.fill","stylers":[{"color":"#000000"}]},{"featureType":"road.arterial","elementType":"geometry.stroke","stylers":[{"color":"#0b3d51"},{"lightness":16}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#000000"}]},{"featureType":"transit","elementType":"all","stylers":[{"color":"#146474"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#021019"}]}];
		else if(s=="Night Blue")
			estilo=[{"featureType":"all","elementType":"labels.text.fill","stylers":[{"color":"#ffffff"}]},{"featureType":"all","elementType":"labels.text.stroke","stylers":[{"visibility":"on"},{"color":"#3e606f"},{"weight":2},{"gamma":0.84}]},{"featureType":"all","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"administrative","elementType":"geometry","stylers":[{"weight":0.6},{"color":"#1a3541"}]},{"featureType":"landscape","elementType":"geometry","stylers":[{"color":"#2c5a71"}]},{"featureType":"poi","elementType":"geometry","stylers":[{"color":"#406d80"}]},{"featureType":"poi.park","elementType":"geometry","stylers":[{"color":"#2c5a71"}]},{"featureType":"road","elementType":"geometry","stylers":[{"color":"#29768a"},{"lightness":-37}]},{"featureType":"transit","elementType":"geometry","stylers":[{"color":"#406d80"}]},{"featureType":"water","elementType":"geometry","stylers":[{"color":"#193341"}]}];
		else if(s=="Blue")
			estilo=[{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#46bcec"},{"visibility":"on"}]}];
		map=new google.maps.Map(document.getElementById('mapa'),{
			disableDefaultUI:true,
			zoomControl:true,
			zoom:6,
			center:{lat:19.3907336,lng:-99.1436126},
			styles:estilo,
			mapTypeId:google.maps.MapTypeId.TERRAIN
		});
		map.data.addListener('click',function(e){
			var bounds=new google.maps.LatLngBounds();
			procesaPoints(e.feature.getGeometry(),bounds.extend,bounds);
			map.fitBounds(bounds);
		});
	}
	$.when(estilos()).done(function(x){
		if(viendo=='Divisiones')creaDivsAreas('Si','','.principal');
		else if(viendo=='Areas')creaAreas('Si','','.principal');
		centraMapa();
	});
}
function limpiaPoligonos(){
	map.data.forEach(function(feature){
		map.data.remove(feature);
	});
}
function limpiaMarcadores(){
	for(var i=0; i<marcadores.length; i++){marcadores[i].setMap(null);}
	marcadores=[];ubicalosFirst=1;
}
function procesaPoints(geometry,callback,thisArg){
	if (geometry instanceof google.maps.LatLng)
		callback.call(thisArg,geometry);
	else if (geometry instanceof google.maps.Data.Point)
		callback.call(thisArg,geometry.get());
	else
		geometry.getArray().forEach(function(g){procesaPoints(g,callback,thisArg);});
}
function setColores(){
	map.data.setStyle(function(feature){
		return({
			fillColor:feature.getProperty('color'),
			strokeOpacity:1,
			strokeWeight:1
		});
	});
	centraMapa();
}
function centraMapa(){
	var bounds=new google.maps.LatLngBounds();
	map.data.addListener('addfeature',function(e){
		procesaPoints(e.feature.getGeometry(),bounds.extend,bounds);
		map.fitBounds(bounds);
	});
}
function pintaPoligonos(gj){
	limpiaPoligonos();
	map.data.addGeoJson(gj);
	setColores();
}
function creaDistritos(){

}
function creaDivsAreas(t,z,y){
	var p=$(y+' .divisiones').find("option").filter(":selected").text(),
		u=$(y+' .divisiones').val();
	$.when(
		promesas.divisiones(p,u)
	).done(function(x){
		x=jQuery.parseJSON(x);
		if(x.hasOwnProperty("errorMessage"))
			creanotificacion('Error:',
				x.errorMessage,'','','error');
		else{
//			if(t=='Si')pintaPoligonos(x.mapa); ERROR en METRO???
		}
		if(z=='Si')$(y+" .areas").append(x.areas);
		$("#loading").hide();
	}).fail(function(jqXHR,textStatus,error){
		creanotificacion('Error:','No se recibió respuesta del servicio de para obtener poligonos de las divisiones.',error,textStatus,'error');
	});
}
function creaAreas(t,z,y){
	var p=$(y+' .areas').find("option").filter(":selected").text(),
		u=$(y+' .areas').val();
	$.when(
		promesas.areas(p,u)
	).done(function(x){
		x=jQuery.parseJSON(x);
		if(x.hasOwnProperty("errorMessage"))
			creanotificacion('Error:',
				x.errorMessage,'','','error');
		else
			if(t=='Si')pintaPoligonos(x);
		$("#loading").hide();
	}).fail(function(jqXHR,textStatus,error){
		creanotificacion('Error:','No se recibió respuesta del servicio de para obtener poligonos de las areas.',error,textStatus,'error');
	});
}
function limpiaTablaG(){
	$('#tablaFielders tbody').html('');
	$('#tablaFielders thead').html('');
}
function muestraUsuarios(){
	tablaFielders.destroy();
	$(".broadcast").hide();
	$('.principal').find('.divisiones').val('0');
	$('.principal').find('.areas').val('0').prop("disabled",true);
	$('.principal').find('.distritos').val('0').prop("disabled",true);
	limpiaTablaG();
	$('#tablaFielders thead').append('<tr>'+
		'<th>Nombre</th>'+
		'<th>Rol</th>'+
		'<th>Expediente</th>'+
		'<th>Usuario</th>'+
		'<th>Región</th>'+
		'<th></th>'+
	'</tr>');
	$.when(promesas.GetFielrs()).done(function(x){
		if(x.hasOwnProperty("errorMessage"))
			creanotificacion('Error','<b>'+x.errorMessage,'','','error');
		else{
			x=jQuery.parseJSON(x);
			$.each(x,function(i,a){
				var reg='',areg=[];
				if(a.hasOwnProperty("regiones")){
					$.each(a.regiones,function(il,al){
						 reg=reg+al+'<br />';
						 areg.push('"'+al+'"');
					});
				}
				$('#tablaFielders tbody').append('<tr><td>'+
					a.nombre+'</td><td>'+
					perfiles(a.role)+'</td><td>'+
					a.expediente+'</td><td>'+
					a.usuario+'</td><td>'+
					reg+'</td><td>'+
					'<a data=\'{"x":"Editar","y":1,"role":"'+a.role+'","idUser":"'+a.idUsuario+'","GCM":"'+a.gcm+'"}\' title="Editar a '+a.nombre+'"><i class="fa fa-pencil-square"></i></a>'+
					'<a data=\'{"x":"Eliminar","idUser":'+a.idUsuario+',"nombre":"'+a.nombre+'"}\' title="Eliminar a '+a.nombre+'"><i class="fa fa-trash"></i></a>'+
					'</td></tr>');
			});
			tablaFielders=$('#tablaFielders').DataTable({
				language:{url:"../js/esp.json"},columnDefs:[{orderable:false,targets:[5]}]
			});
			$('#ctable').addClass('s');
			$('#calendar').removeClass('s');
			$('#top,#generico').addClass("open");
			$('#mapa,#generico').addClass("openB");
			$("#loading").hide();
		}
	});
}
function muestraCalendario(){
	$('#top,#generico').addClass("open");
	$('#mapa,#generico').addClass("openB");
	$("#loading").hide();
	$('#ctable').removeClass('s');
	$('#calendar').addClass('s');
	var calendar=$('#calendar').fullCalendar({
		header: {
			left: 'prev,next today',
			center: 'title',
			right: 'month,basicWeek,basicDay'
		},
		defaultDate: '2016-01-12',
		lang:'es',
		selectable: true,
		selectHelper: true,
		select: function(start, end, allDay){
			var title = prompt('Campaña:');
			if (title){
				calendar.fullCalendar('renderEvent',{
						title: title,
						start: start,
						end: end,
						allDay: allDay,
						className:'amarillo'
					},
					true
				);
			}
			calendar.fullCalendar('unselect');
		},
		eventLimit:false,
		editable:true,
		events:[
			{
				title: 'All Day Event',
				start: '2016-01-24',
				className:'Rojo'
			}
		]
	});
}
function muestraCampanas(){
	tablaFielders.destroy();
	$(".broadcast").hide();
	$('.principal').find('.divisiones').val('0');
	$('.principal').find('.areas').val('0').prop("disabled",true);
	$('.principal').find('.distritos').val('0').prop("disabled",true);
	limpiaTablaG();
	$('#tablaFielders thead').append('<tr>'+
		'<th>Título</th>'+
		'<th>tCode</th>'+
		'<th>CampaignCode</th>'+
		'<th>OfferCode</th>'+
		'<th>Fecha</th>'+
		'<th></th>'+
	'</tr>');
	function GetCampasMias(){
		$.when(promesas.GetCRdCam('1-6-0-0')).done(function(x){
//			console.log(x);
			x=jQuery.parseJSON(x);
			if(x.Error!='') creanotificacion('Error 404:',x.Error,'','','error');
			else if(x.Sin!='') creanotificacion('Sin regiones',x.Sin,'','','advertencia');
			else $.each(x.Regiones,function(i,a){
				$('#tablaFielders tbody').append('<tr><td>'+
					a.titulo+'</td><td>'+
					a.tcode+'</td><td>'+
					a.campaigncode+'</td><td>'+
					a.offercode+'</td><td>'+
					a.createAt+'</td><td>'+
					'<a data=\'{"x":"AddFieldersC","id":'+a.id_CR+',"titulo":"'+a.titulo+'"}\' title="Añadir Fielders a campaña '+a.titulo+'"><i class="fa fa-users"></i></a>'+
					'<a data=\'{"x":"EliminarCamp","id":'+a.id_CR+',"titulo":"'+a.titulo+'"}\' title="Eliminar campaña '+a.titulo+'"><i class="fa fa-trash"></i></a>'+
					'</td></tr>');
			});
			creaTablaYa();
		});
	}
	function creaTablaYa(){
		tablaFielders=$('#tablaFielders').DataTable({
			language:{url:"../js/esp.json"},columnDefs:[{orderable:false,targets:[5]}],order:[[4,"desc"]]
		});
		$('#ctable').addClass('s');
		$('#calendar').removeClass('s');
		$('#top,#generico').addClass("open");
		$('#mapa,#generico').addClass("openB");
		$("#loading").hide();
	}
	$.when(promesas.GetCampas()).done(function(x){
		if(x.hasOwnProperty("errorMessage"))
			creanotificacion('Error','<b>'+x.errorMessage,'','','error');
		else{
			x=jQuery.parseJSON(x);
			$.each(x,function(i,a){
				$('#tablaFielders tbody').append('<tr><td>'+
					a.titulo+'</td><td>'+
					a.tcode+'</td><td>'+
					a.campaigncode+'</td><td>'+
					a.offercode+'</td><td>'+
					a.createAt+'</td><td>'+
					'<a data=\'{"x":"EditarCamp'+
						'","id":"'+a.id+
						'","titulo":"'+a.titulo+
						'","tcode":"'+a.tcode+
						'","campaigncode":"'+a.campaigncode+
						'","offercode":"'+a.offercode+
						'","descripcion":"'+a.descripcion+
						'","createAt":"'+a.createAt+'"}\' title="Editar campaña '+a.titulo+'"><i class="fa fa-pencil-square"></i></a>'+
					'<a data=\'{"x":"AddRegionesC","id":'+a.id+',"titulo":"'+a.titulo+'"}\' title="Añadir Regiones a campaña '+a.titulo+'"><i class="fa fa-codiepie"></i></a>'+
					'<a data=\'{"x":"EliminarCamp","id":'+a.id+',"titulo":"'+a.titulo+'"}\' title="Eliminar campaña '+a.titulo+'"><i class="fa fa-trash"></i></a>'+
					'</td></tr>');
			});
		}
		GetCampasMias();
	});
}
function buscaFielders(){
	var region;
	function datosFielders(r){ var Pi;
		if(dis_o_col=='todos') Pi=promesas.fieldersA(r);
		else Pi=promesas.fieldersR(r);
		return Pi;
	}
	function clearTabla(f){
		if(dis_o_col!='colonias')
			tablaFielders.destroy();
		limpiaTablaG();
		$('#tablaFielders thead').append('<tr>'+
			'<th>Nombre</th>'+
			'<th>Expediente</th>'+
			'<th></th>'+
		'</tr>');
		var li=0;
		$.each(f,function(i,a){
			$('#tablaFielders tbody').append('<tr><td>'+
				a[2]+'</td><td>'+
				a[5]+'</td><td>'+
				'<a data=\'{"x":"Mensaje","regid":"'+a[10]+'","idUser":'+a[0]+',"nombre":"'+a[2]+'"}\' title="Enviar mensaje a '+a[2]+'"><i class="fa fa-comment"></i></a>'+
				'<a data=\'{"x":"Editar","y":2,"idUser":'+a[0]+',"GCM":"'+a[10]+'"}\' title="Editar regiones de '+a[2]+'"><i class="fa fa-random"></i></a>'+
				'</td></tr>');
			li++;
		});
		if(li>0)$(".broadcast").show();else $(".broadcast").hide();
	}
	function pintaFielders(f){
		var s=[];
		f=jQuery.parseJSON(f);
		$.when(clearTabla(f)).done(function(x){
			tablaFielders=$('#tablaFielders').DataTable({language:{url:"../js/esp.json"},columnDefs:[{orderable:false,targets:[2]}]});
			$('#ctable').addClass('s');
			$('#calendar').removeClass('s');
			$("#loading").hide();
		})
	}
	function pintaDistritos(){
		$.when(
			promesas.Fdistritos(ForDistritos)
		).done(function(x){
			x=jQuery.parseJSON(x);
			if(x.hasOwnProperty("errorMessage"))
				creanotificacion('Error:',
					x.errorMessage,'','','error');
			else
				pintaPoligonos(x);
		}).fail(function(jqXHR,textStatus,error){
			creanotificacion('Error:','No se recibió respuesta del servicio de para pintar los distritos.',error,textStatus,'error');
		});
	}
	if(todosdiv=='principal'){
		var val=$('.principal .ui-autocomplete-input').val();
		$('#top,#generico').addClass("open");
		if(dis_o_col=='distritos'){
			region=nvoDivi + '-' + nvoArea + '-' + val+'-0';
			ForDistritos=val;
		}
		else if(dis_o_col=='colonias'){
			region=nvoDivi + '-' + nvoArea + '-0-' + val;
			ForColonias=val;
		}
		else if(dis_o_col=='todos'){
			region=nvoDivi + '-' + nvoArea + '-';
		}
		$.when(
			datosFielders(region)
		).done(function(x){
			pintaFielders(x);
			if(dis_o_col=='distritos')pintaDistritos();
		}).fail(function(jqXHR,textStatus,error){
			creanotificacion('Error:','No se recibió respuesta del servicio de para obtener los datos de los fielders buscados.',error,textStatus,'error');
		});
	}
}
function mensajeUnico(i,r,n){ //id,reggcm,nombre
	if(i!='' && r!='' && n!=''){
		dialogos('<form class="msjU" title="Enviar mensaje a '+n+'">'+
			'<fieldset>'+
				'<textarea placeholder="Escribe tu mensaje..."></textarea>'+
				'<input type="hidden" class="rgid" value="'+r+'" />'+
				'<input type="hidden" class="usid" value="'+i+'" />'+
				'<button type="submit">Enviar</button>'+
			'</fieldset>'+
		'</form>','');
	}
	else{
		alert('Muchos!');
	}
	$("#loading").hide();
}
function meteRegionaCR(asig){
	var region=nvoDivi + '-' + nvoArea + '-0-0',btn=asig.parent().find('.busca'),id_edit=asig.parent().parent().find('.id_editado').val();
	if(!!~jQuery.inArray(region,RegionesCR)){
		creanotificacion('No se agregó región','Ya se encunetra asignada la región que intentas agregar a la campaña.','','','');
	}
	else{
		$.when(
			promesas.RegAddCR(id_edit,region)
		).done(function(x){x=JSON.parse(x);
			RegionesCR.push(region);region=regisdivareas(region);
			asig.append("<a data-id='"+x[0].id+"' data='"+region.original+"'>"+region.regionT+"</a>");
		});
	}
	setTimeout(function(){ btn.removeClass('guardando'); },500);
}
function agregaRegFielder(dist,asig,empl,rgcm,y){
	var region='',btn=asig.parent().find('.busca');
	if(dist==""){
		creanotificacion('No se agregó región','No escribiste ningún texto para poder agregar una región al usuario.','','','advertencia');
		setTimeout(function(){ btn.removeClass('guardando'); },500);
	}
	else{
		if(dist=='smpr')
			region=nvoDivi + '-' + nvoArea + '-0-0';
		else if(dis_o_col=='distritos'){
			if(!!~jQuery.inArray(dist,jQuery.parseJSON(ForDistritos)))
				region=nvoDivi + '-' + nvoArea + '-' + dist+'-0';
		}
		else if(dis_o_col=='colonias'){
			if(!!~jQuery.inArray(dist,jQuery.parseJSON(ForColonias)))
				region=nvoDivi + '-' + nvoArea + '-0-' + dist;
		}
		if(region!=''){
			if(!!~jQuery.inArray(region,RegionesUser)){
				creanotificacion('No se agregó región','El promotor ya esta asignado a la región que intentas asignar.',
				'','','');
				setTimeout(function(){ btn.removeClass('guardando'); },500);
			}
			else{
				region=regisdivareas(region);
				$.when(promesas.addRegion(empl,idBoss,region.original,rgcm,region.region)).done(function(x){
					console.log(x);
					x=jQuery.parseJSON(x);
					if(x.hasOwnProperty("errorSinMensaje")){
						creanotificacion('Error',x.errorSinMensaje,'','','error');
						btn.removeClass('guardando').addClass('bad');
					}
					else{
						if(x.hasOwnProperty("errorMessage"))
							creanotificacion('No se envió mensaje',x.errorMessage+':<br /><b>'+x.error+'</b><br /><br /><b>id:</b> '+x.multicast_id,'','','advertencia');
						btn.removeClass('guardando').addClass('ok');
						RegionesUser.push(region.original);
						asig.append("<a data='"+region.original+"'>"+region.regionT+"</a>");
						if(y==1)muestraUsuarios();
					}
					setTimeout(function(){ btn.removeClass('bad').removeClass('ok'); },1500);
				});
			}
		}
		else{
			creanotificacion('No se agregó región','La región o colonia que intentas agregar no existe en nuestra base de datos, no se agregará al usuario, intentalo nuevamente.',
			'','','advertencia');
			setTimeout(function(){ btn.removeClass('guardando'); },800);
		}
	}
}
function nuevoUsuario(){
	dialogos('<form class="edUS" data="Usuarios" title="Nuevo usuario">'+
	'<fieldset><h4>Información:</h4>'+
	'<input type="hidden" class="id_editado" value="ZZ" />'+
	'<input type="hidden" class="id_gcm" value="" />'+
	'<input type="hidden" class="y" value="1" />'+
	'<label>Nombre<input type="text" class="nombre" value="" /></label>'+
	'<label>Expediente<input type="text" class="expediente" value="" /></label>'+
	'<label>Usuario<input type="text" class="usuario" value="" /></label>'+
	'<label>Contraseña<input type="password" class="passwd" value="" placeholder="******" /></label>'+
	'<label>Perfil<select class="rol">'+
	'<option value="5">Director</option>'+
	'<option value="4">Administrador</option>'+
	'<option value="6">Lider Promotor</option>'+
	'<option value="7">Promotor</option></select></label>'+
	'<button class="datos">Guardar usuario</button>'+
	'</fieldset>'+
	'</form>','');
	$("#loading").hide();
}
function nuevaCampana(){
	dialogos('<form class="edUS" data="Campanas" title="Nueva campaña">'+
	'<fieldset><h4>Información:</h4>'+
	'<input type="hidden" class="id_editado" value="ZZ" />'+
	'<label>Título<input type="text" class="titulo" value="" /></label>'+
	'<label>tCode<input type="text" class="tcode" value="" /></label>'+
	'<label>CampaignCode<input type="text" class="campaigncode" value="" /></label>'+
	'<label>OfferCode<input type="text" class="offercode" value="" /></label>'+
	'<label>Descripción<input type="text" class="descripcion" value="" /></label>'+
	'<button class="datos">Guardar campaña</button>'+
	'</fieldset>'+
	'</form>','');
	$("#loading").hide();
}
function editarCampana(d){
	dialogos('<form class="edUS" data="Campanas" title="Editando campaña '+d.titulo+'">'+
	'<fieldset>'+
	'<input type="hidden" class="id_editado" value="'+d.id+'" />'+
	'<label>Título<input type="text" class="titulo" value="'+d.titulo+'" /></label>'+
	'<label>tCode<input type="text" class="tcode" value="'+d.tcode+'" /></label>'+
	'<label>CampaignCode<input type="text" class="campaigncode" value="'+d.campaigncode+'" /></label>'+
	'<label>OfferCode<input type="text" class="offercode" value="'+d.offercode+'" /></label>'+
	'<label>Descripción<input type="text" class="descripcion" value="'+d.descripcion+'" /></label>'+
	'<button class="datos">Guardar cambios</button>'+
	'</fieldset>'+
	'</form>',660);
	$("#loading").hide();
}
function AddRegionesC(d){
	dialogos('<form class="edUS arc" data="AddRegionesCampanas" title="Regiones asignadas a campaña '+d.titulo+'">'+
	'<fieldset style="display:none;">'+
	'<input type="hidden" class="id_editado" value="'+d.id+'" />'+
	'</fieldset><fieldset><h4>Añadir región:</h4>'+
	'<label>Divsión<select class="divisiones"></select></label>'+
	'<label>Área<select class="areas" disabled="disabled"></select></label>'+
	'<button class="busca">Añadir región</button>'+
	'<h4>Regiones asignadas:</h4>'+
	'<h5>Seguro deseas eliminar esta región: <a class="CRsi">Si</a> / <a>No</a></h5>'+
	'<div class="asignadas"></div>'+
	'</fieldset>'+
	'</form>','');
	$.when(promesas.GetCRdCam(d.id)).done(function(x){
		x=jQuery.parseJSON(x);
		RegionesCR=[];
		selectDivisiones('.edUS fieldset label');
		if(x.Error!='') creanotificacion('Error 404:',x.Error,'','','error');
		else if(x.Sin!='') creanotificacion('Sin regiones',x.Sin,'','','advertencia');
		else $.each(x.Regiones,function(i,v){
			RegionesCR.push(v.Region);
			region=regisdivareas(v.Region);
			$('.edUS fieldset .asignadas').append("<a data-id='"+v.id_CR+"' data='"+region.original+"'>"+region.regionT+"</a>");
		});
		$("#loading").hide();
	});
}
function AddFieldersC(d){
	dialogos('<form class="edUS" data="Campanas" title="Fielders asignados a campaña '+d.titulo+'">'+
	'<fieldset><h4>Información:</h4>'+
	'<input type="hidden" class="id_editado" value="'+d.id+'" />'+
	'<button class="datos">Guardar cambios</button>'+
	'</fieldset>'+
	'</form>','');
	$.when(promesas.GetAllCFR(d.id)).done(function(x){
		x=jQuery.parseJSON(x);
		console.log(x);
		$("#loading").hide();
	});
}
function editarUsuario(e){ //id,reggcm,nombre
	var regs='',r_d='',r_a='',r_l='',r_p='',spr=' smpr',smpr='smpr';
	RegionesUser=[];
	function meteReg(d){
		if(d!=null){
			if(d.Regiones!=''){
				$.each(d.Regiones,function(i,a){
					var laregi=regisdivareas(a);
					RegionesUser.push(a);
					regs=regs+'<a data="'+a+'">'+laregi.regionT+'</a>';
				});
			}
		}
		else d={nombre:'',expediente:'',usuario:'',role:''};
		if(e.GCM==null || e.GCM=='null')e.GCM='';
		if(e.role==5){
			r_d=' selected="selected"';
		}
		else if(e.role==4){
			r_a=' selected="selected"';
		}
		else if(e.role==6){
			r_l=' selected="selected"';
		}
		else if(e.role==7){
			r_p=' selected="selected"';
			spr='';smpr='';
		}
		var forma='<form class="edUS'+spr+'" data="Usuarios" title="Editando a '+d.nombre+'">'+
		'<fieldset><h4>Información:</h4>'+
		'<input type="hidden" class="id_editado" value="'+e.idUser+'" />'+
		'<input type="hidden" class="id_gcm" value="'+e.GCM+'" />'+
		'<input type="hidden" class="y" value="'+e.y+'" />'+
		'<label>Nombre<input type="text" class="nombre" value="'+d.nombre+'" /></label>'+
		'<label>Expediente<input type="text" class="expediente" value="'+d.expediente+'" /></label>'+
		'<label>Usuario<input type="text" class="usuario" value="'+d.usuario+'" /></label>'+
		'<label>Contraseña<input type="password" class="passwd" value="" placeholder="******" /></label>'+
		'<label>Perfil<select class="rol">'+
		'<option value="5"'+r_d+'>Director</option>'+
		'<option value="4"'+r_a+'>Administrador</option>'+
		'<option value="6"'+r_l+'>Lider Promotor</option>'+
		'<option value="7"'+r_p+'>Promotor</option></select></label>'+
		'<button class="datos">Guardar datos</button>'+
		'</fieldset><fieldset><h4>Añadir región:</h4>'+
		'<label>Divsión<select class="divisiones"></select></label>'+
		'<label>Área<select class="areas" disabled="disabled"></select></label>'+
		'<label>Distrito/Colonia<select class="distritos" disabled="disabled">'+
		'<option value="0"> --- </option>'+
		'<option value="1">Distritos</option>'+
		'<option value="3">Colonias</option>'+
		'</select></label>'+
		'<label class="busca">Buscar<input type="text" class="ui-autocomplete-input" value="'+smpr+'" /></label>'+
		'<button class="busca">Añadir región</button>'+
		'<h4>Regiones asignadas:</h4>'+
		'<h5>Seguro deseas eliminar esta región: <a class="si">Si</a> / <a>No</a></h5>'+
		'<div class="asignadas">'+regs+'</div>'+
		'</fieldset>'+
		'</form>';
		$.when(dialogos(forma,700)).done(function(x){selectDivisiones('.edUS fieldset label');});
	}
	function B(x){
		$.when(meteReg(x)).done(function(x){$("#loading").hide();});
	}
	$.when(promesas.fielderIN(e.idUser)).done(function(x){B(jQuery.parseJSON(x));});
}
function cierraMenu(){$('nav.gn-menu-wrapper').removeClass("gn-open-part").removeClass("gn-open-all");$('li.gn-trigger a.gn-icon.gn-icon-menu').removeClass("gn-selected");}
function selectDivisiones(c){
	var P=getPromesa({pky:'46%6&fyR'});
	P.done(function(data){
		data=jQuery.parseJSON(data);$(c+" .divisiones").append('<option value="0" disabled selected>Division:</option>');
		$.each(data,function(i,a){$(c+" .divisiones").append('<option value="'+a.id+'">'+a.de+'</option>');});
	}).fail(function(jqXHR,textStatus,error){
		creanotificacion('Error:','No se recibió respuesta del servicio de para obtener las divisiones.',error,textStatus,'error');
	});
}
function inicia(){
	google.maps.event.addDomListener(window,'load',creaMapa("Blue"));
	$('#top #midatos .data .n').text(Nombre);
	$('#top #midatos .data .id').text('id: '+idBoss);
	$('#top #midatos .data .u').text('Usuario: '+Usuario);
	$('#top #midatos .data .r').text(Rol);
	selectDivisiones('.principal');
}inicia();

$(document).on("change",".ChangeColorMapa",function(event){event.preventDefault();creaMapa($(this).val());});
$(document).on("click",".gn-icon.gn-icon-salir",function(event){event.preventDefault();salir();});
$(document).on("change",".divisiones",function(){
	$("#loading").show();
	var	ap=$(this),
		tc=$(this).children("option").filter(":selected").text();
	todosdiv=$(this).parent().attr('class');
	nvoDivi=$(this).val();
	dG.add(aG).removeClass("c");
	if(todosdiv=='principal'){
		$(".broadcast").hide();
		$('#top,#generico').removeClass("open");
		$('#mapa,#generico').removeClass("openB");
		limpiaMarcadores();viendo='Divisiones';
		clearInterval(intervaloMarcadores);
		ap.parent().find('.areas').html('').prop("disabled",false);
		ap.parent().find('.distritos').val('0').prop("disabled",true);
		creaDivsAreas('Si','Si','.principal');
	}
	else{
		if(typeof todosdiv==='undefined'){
			todosdiv=$(this).parent().parent().parent().attr('class');
			$(this).parent().parent().find('.busca').removeClass('c');
		}
		ap.parent().parent().find('.areas').html('').prop("disabled",false);
		ap.parent().parent().find('.distritos').val('0').prop("disabled",true);
		creaDivsAreas('','Si','.edUS fieldset label');
	}
});
$(document).on("change",".areas",function(){
	$("#loading").show();
	var	ap=$(this),
		tc=$(this).children("option").filter(":selected").text();
	todosdiv=$(this).parent().attr('class');
	nvoArea=$(this).val();
	dG.add(aG).removeClass("c");
	if(todosdiv=='principal'){
		$(".broadcast").hide();
		$('#top,#generico').removeClass("open");
		limpiaMarcadores();viendo='Areas';
		clearInterval(intervaloMarcadores);
		ap.parent().parent().find('.distritos').val('0').prop("disabled",false);
		creaAreas('Si','Si','.principal');
	}
	else{
		if(typeof todosdiv==='undefined'){
			todosdiv=$(this).parent().parent().parent().attr('class');
			console.log(todosdiv);
			if(todosdiv=='edUS arc ui-dialog-content ui-widget-content')
				$(this).parent().parent().find('.busca').addClass('c');
			else if(todosdiv=='edUS smpr ui-dialog-content ui-widget-content'){
				$(this).parent().parent().find('button.busca').addClass('c');
				$(this).parent().parent().find('.ui-autocomplete-input').val('smpr');
			}
		}
		ap.parent().parent().find('.distritos').val('0').prop("disabled",false);
		$("#loading").hide();
	}
});
$(document).on("change",".distritos",function(){
	$("#loading").show();$(".broadcast").hide();
	var	ap=$(this),
		tc=$(this).val();
	todosdiv=$(this).parent().attr('class');
	if(todosdiv=='principal'){
		$('#ctable').removeClass('s');
		$('#calendar').removeClass('s');
		$('#top,#generico').removeClass("open");
		dG=$('.principal .ui-autocomplete-input');
		aG=$('.principal .busca');
	}
	else{
		dG=$('.edUS fieldset .ui-autocomplete-input');
		aG=$('.edUS fieldset .busca');
	}
	dG.add(aG).removeClass("c");
	dG.val('').autocomplete({ create:function(event,ui){} });
	if(tc==0){ // Nada
		$("#loading").hide();
	}
	else if(tc==1){ // Distritos
		$.when(promesas.distritos(nvoArea)).done(function(x){
			ForDistritos=x;
			x=jQuery.parseJSON(x);
			dis_o_col='distritos';
			dG.add(aG).addClass("c");
			dG.attr("placeholder","Buscar distrito").autocomplete({source:x});
			$("#loading").hide();
		});
	}
	else if(tc==2){ // Todos Distritos
		$('#top,#generico').addClass("open");
		$.when(promesas.distritos(nvoArea)).done(function(x){
			ForDistritos=x;
			x=jQuery.parseJSON(x);
			dis_o_col='todos';
			buscaFielders();
		});
	}
	else if(tc==3){ // Colonias
		$.when(promesas.colonias(6)).done(function(x){
			ForColonias=x;
			x=jQuery.parseJSON(x);
			dis_o_col='colonias';
			dG.add(aG).addClass("c");
			dG.attr("placeholder","Buscar colonia").autocomplete({source:x});
			$("#loading").hide();
		});
	}
});
$(document).on("click","#ventana #close a",function(event){event.preventDefault();});
$(document).on("click","button.busca",function(event){event.preventDefault();
	todosdiv=$(this).parent().attr('class');
	if(todosdiv=='principal'){
		$("#loading").show();buscaFielders();
	}
	else{
		var dist=$(this).parent().find('label .ui-autocomplete-input').val(),
			asig=$(this).parent().find('.asignadas'),
			empl=$(this).parent().parent().find('fieldset .id_editado').val(),
			y=$(this).parent().parent().find('fieldset .y').val(),
			rgcm=$(this).parent().parent().find('fieldset .id_gcm').val();
		$(this).addClass('guardando');
		if(typeof dist==='undefined')
			meteRegionaCR(asig);
		else
			agregaRegFielder(dist,asig,empl,rgcm,y);
	}
});
$(document).on("keypress",".ui-autocomplete-input",function(event){
	if(event.keyCode==13){event.preventDefault();
		todosdiv=$(this).parent().attr('class');
		if(todosdiv=='principal'){
			$("#loading").show();buscaFielders();
		}
		else{
			var dist=$(this).parent().parent().find('label .ui-autocomplete-input').val(),
				asig=$(this).parent().parent().find('.asignadas'),
				empl=$(this).parent().parent().parent().find('fieldset .id_editado').val(),
				y=$(this).parent().parent().parent().find('fieldset .y').val(),
				rgcm=$(this).parent().parent().parent().find('fieldset .id_gcm').val();
			$(this).parent().parent().find('.busca').addClass('guardando');
			agregaRegFielder(dist,asig,empl,rgcm,y);
		}
	}
});
$(document).on("click",".broadcast",function(event){event.preventDefault();$("#loading").show();mensajeUnico('','','');});
$(document).on("click","#tablaFielders tbody tr td a",function(event){event.preventDefault();
	$("#loading").show();
	var data=jQuery.parseJSON($(this).attr('data'));
	if(data.x=='Mensaje')
		mensajeUnico(data.idUser,data.regid,data.nombre);
	else if(data.x=='Editar')
		editarUsuario(data);
	else if(data.x=='Eliminar'){
		$.when(promesas.DeleteUse(data.idUser)).done(function(x){
			muestraUsuarios();
		});
	}
	else if(data.x=='EditarCamp'){
		editarCampana(data);
	}
	else if(data.x=='AddRegionesC'){
		AddRegionesC(data);
	}
	else if(data.x=='AddFieldersC'){
		AddFieldersC(data);
	}
	else if(data.x=='EliminarCamp'){
		$.when(promesas.DeleteCam(data.id)).done(function(x){console.log(x);muestraCampanas();});
	}
});
$(document).on("submit",".ui-dialog .msjU",function(event){event.preventDefault();
	$("#loading").show();
	var r=$(this).find('.rgid').val(),
		i=$(this).find('.usid').val(),
		t=$(this).find('textarea').val();
	if(t=='')
		creanotificacion('No se envió mensaje','No escribiste ningún texto para mandar.','','','advertencia');
	else{
		$.when(promesas.SendMesje(idBoss,r,i,t)).done(function(x){
			x=jQuery.parseJSON(x);
			console.log(x);
			if(x.hasOwnProperty("errorMessage"))
				creanotificacion('Error',x.errorMessage+':<br /><b> '+x.error+'</b><br /><br /><b>id:</b> '+x.multicast_id,'','','error');
			else if(x.hasOwnProperty("errorSinMensaje"))
				creanotificacion('No se envió mensaje',x.errorSinMensaje,'','','advertencia');
			else{
				creanotificacion('Mensaje enviado','<b>Emisor:</b> '+x.Emisor+
					'<br /><b>Receptor:</b> '+x.Receptor+
					'<br /><b>Mensaje:</b> '+x.Mensaje+
					'<br /><b>ID:</b> '+x.multicast_id+
					'<br /><b>Mensaje ID:</b> '+x.message_id,'','','');
			}
		});
	}
	$("#loading").hide();
});
$(document).on("click",".edUS .datos",function(event){event.preventDefault();
	var f=$(this).parent().parent().attr('data'),
		b=$(this);
	b.addClass('guardando');
	if(f=='Usuarios'){
		var n=$(this).parent().find('.nombre').val(),
			i=$(this).parent().find('.id_editado').val(),
			e=$(this).parent().find('.expediente').val(),
			u=$(this).parent().find('.usuario').val(),
			p=$(this).parent().find('.passwd').val(),
			r=$(this).parent().find('.rol').val(),
			y=$(this).parent().find('.y').val();
		if(n!='' && u!='' && r!='' && i!='ZZ'){
			$.when(promesas.UpdateUse(n,i,e,u,p,r)).done(function(x){
				if(y==1)muestraUsuarios();
				if(x==0)b.removeClass('guardando').addClass('ok');
				else b.removeClass('guardando').addClass('bad');
				setTimeout(function(){ b.removeClass('bad').removeClass('ok'); }, 2500);
			});
		}
		else if(n!='' && u!='' && r!='' && p!='' && i=='ZZ'){
			$.when(promesas.AddingUse(n,e,u,p,r)).done(function(x){
				if(y==1)muestraUsuarios();
				if(x==0)b.removeClass('guardando').addClass('ok');
				else b.removeClass('guardando').addClass('bad');
				setTimeout(function(){b.removeClass('bad').removeClass('ok');},1500);
			});
		}
	}
	else if(f=='AddRegionesCampanas'){
		alert(b);
	}
	else{
		var i=$(this).parent().find('.id_editado').val(),
			e=$(this).parent().find('.titulo').val(),
			u=$(this).parent().find('.tcode').val(),
			p=$(this).parent().find('.campaigncode').val(),
			r=$(this).parent().find('.offercode').val(),
			d=$(this).parent().find('.descripcion').val();
		if(e!='' && u!='' && p!='' && r!='' && i!='ZZ'){
			$.when(promesas.UpdateCpm(i,e,u,p,r,d)).done(function(x){
				muestraCampanas();
				if(x==0)b.removeClass('guardando').addClass('ok');
				else b.removeClass('guardando').addClass('bad');
				setTimeout(function(){ b.removeClass('bad').removeClass('ok'); }, 2500);
			});
		}
		else if(n!='' && u!='' && r!='' && p!='' && i=='ZZ'){
			$.when(promesas.AddingCpm(e,u,p,r,d)).done(function(x){
				muestraCampanas();
				if(x==0)b.removeClass('guardando').addClass('ok');
				else b.removeClass('guardando').addClass('bad');
				setTimeout(function(){b.removeClass('bad').removeClass('ok');},1500);
			});
		}
	}
});
$(document).on("click",".edUS .region",function(event){event.preventDefault();
	alert('Agrega región');
});
$(document).on("click",".edUS h5 a",function(event){event.preventDefault();
	var P=$(this).parent().parent().parent().find('.id_editado').val(),
		y=$(this).parent().parent().parent().find('.y').val(),
		R=$(this).parent().parent().find('.asignadas a.eliminando').attr('data'),
		V=$(this).parent().parent().find('.asignadas a.eliminando'),
		C=$(this).attr('class');
	if(C=='si')
		$.when(promesas.RegDelete(P,R)).done(function(x){
			V.remove();
			if(y==1)muestraUsuarios();
			RegionesUser=jQuery.grep(RegionesUser,function(v){return v!=R;});
		});
	else if(C=='CRsi'){
		var I=$(this).parent().parent().find('.asignadas a.eliminando').attr('data-id');
		$.when(promesas.RegDeleteCR(I)).done(function(x){
			V.remove(); RegionesCR=jQuery.grep(RegionesCR,function(v){return v!=R;});
		});
	}
	V.removeClass('eliminando');
	$(this).parent().hide();
});
$(document).on("click",".edUS .asignadas a",function(event){event.preventDefault();
	$(this).parent().find('a').removeClass('eliminando');
	$(this).parent().parent().find('h5').show();
	$(this).addClass('eliminando');
});

$("#losUsers").click(function(event){
	event.preventDefault();
	dG.add(aG).removeClass("c");
	cierraMenu();
	$('#top,#generico').removeClass("open");
	$("#loading").show();
	muestraUsuarios();
});
$(".gn-icon.gn-icon-home").click(function(event){
	event.preventDefault();
	cierraMenu();
	$('#top,#generico').removeClass("open");
	$('#mapa,#generico').removeClass("openB");
});
$(".gn-icon.gn-icon-nuser").click(function(event){
	event.preventDefault();
	cierraMenu();
	dG.add(aG).removeClass("c");
	$('#top,#generico').removeClass("open");
	$("#loading").show();
	muestraUsuarios();
	nuevoUsuario();
});
$(".gn-icon.gn-icon-campana").click(function(event){
	event.preventDefault();
	cierraMenu();
	dG.add(aG).removeClass("c");
	$('#top,#generico').removeClass("open");
	$("#loading").show();
	muestraCampanas();
});
$(".gn-icon.gn-icon-ncampana").click(function(event){
	event.preventDefault();
	cierraMenu();
	dG.add(aG).removeClass("c");
	$('#top,#generico').removeClass("open");
	$("#loading").show();
	muestraCampanas();
	nuevaCampana();
});
$(".gn-icon.gn-icon-calendar").click(function(event){
	event.preventDefault();
	cierraMenu();
	dG.add(aG).removeClass("c");
	$('#top,#generico').removeClass("open");
	$("#loading").show();
	muestraCalendario();
});

/* $("#mapa").dialog({
	resize: function(event,ui){
		creaMapa($('.ChangeColorMapa').val());
	}
}); */